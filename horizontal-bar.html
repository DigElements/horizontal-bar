<!--
Copyright 2017 Next Century Corporation

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../paper-checkbox/paper-checkbox.html">

<!--
A Polymer Element showing a sized, labeled, colored bar and a checkbox.

### Example
```html
<horizontal-bar
  name="Test"
  count="123"
  max="456"
  toggle-listener="[[listener]]">
</horizontal-bar>
```

### Styling

`<horizontal-bar>` provides the following custom properties and mixins for styling:

Custom property                | Description                   | Default
-------------------------------|-------------------------------|-----------------------
`--horizontal-bar-color`       | The color of the bar.         | --light-primary-color
`--horizontal-bar-count-color` | The color of the count label. | --secondary-text-color
`--horizontal-bar-height`      | The height of the bar.        | 20px
`--horizontal-bar-title-color` | The color of the title label. | --primary-text-color

@demo demo/index.html
-->

<dom-module id="horizontal-bar">
  <template>
    <style include="iron-flex iron-flex-alignment"></style>

    <style>
      :host {
        display: block;
      }

      .row-wrapper {
        margin-top: 4px;
      }

      .bar-checkbox {
        --paper-checkbox-label-spacing: 4px;
        --paper-checkbox-size: 16px;
        position: relative;
        top: 2px;
      }

      .bar-wrapper {
        height: var(--horizontal-bar-height, 20px);
        width: 100%;
        position: relative;
      }

      .bar {
        background-color: var(--horizontal-bar-color, --light-primary-color);
        border-radius: 2px;
        position: absolute;
        left: 0;
        top: 0px;
        bottom: 0px;
      }

      .bar-title {
        color: var(--horizontal-bar-title-color, --primary-text-color);
        padding: 0 5px;
        position: relative;
        text-shadow: 1px 1px 0 rgba(255,255,255,0.5);
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .bar-count {
        color: var(--horizontal-bar-count-color, --secondary-text-color);
        font-weight: bold;
        padding: 0 5px;
        position: relative;
        text-shadow: 1px 1px 0 rgba(255,255,255,0.5);
      }

      a {
        color: var(--horizontal-bar-title-color, --primary-text-color);
        padding: 0 5px;
        position: relative;
        text-shadow: 1px 1px 0 rgba(255,255,255,0.5);
        text-overflow: ellipsis;
        white-space: nowrap;
      }
    </style>

    <div class="layout horizontal row-wrapper">
      <template is="dom-if" if="[[showCheckbox]]">
        <paper-checkbox class="bar-checkbox" name="[[name]]" checked="[[selected]]" on-change="_onToggle"></paper-checkbox>
      </template>
      <div class="layout horizontal center center-justified bar-wrapper">
        <template is="dom-if" if="{{linkValue}}">
          <a class="layout horizontal center center-justified bar-wrapper" href="{{linkValue}}">
            <div class="bar" style$="width: [[_width]]%;"></div>
            <div class="bar-title flex">
              [[name]]
            </div>
            <div class="bar-count flex-none">
              [[count]]
            </div>
          </a>
        </template>
        <template is="dom-if" if="{{!linkValue}}">
          <div class="bar" style$="width: [[_width]]%;"></div>
          <div class="bar-title flex">
            [[name]]
          </div>
          <div class="bar-count flex-none">
            [[count]]
          </div>
        </template>
      </div>
    </div>
  </template>

  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'horizontal-bar',

      properties: {
        /**
         * (Optional)
         *
         * The name to show on the left of the bar.
         *
         * @type {String}
         * @default ''
         */
        name: {
          type: String,
          value: ''
        },

        /**
         * (Optional)
         *
         * The count to show on the right of the bar.
         *
         * @type {Number}
         * @default 0
         */
        count: {
          type: Number,
          value: 0
        },

        /**
         * (Optional)
         *
         * The max count used to compute the bar width (count / max).
         *
         * @type {Number}
         * @default 0
         */
        max: {
          type: Number,
          value: 0
        },

        /**
         * (Optional)
         *
         * Whether to show a checkbox to the left of the horizontal bar.
         *
         * @type {Boolean}
         * @default false
         */
        showCheckbox: {
          type: Boolean,
          value: false
        },

        /**
         * (Optional|Output)
         *
         * Whether the bar's checkbox is selected.
         *
         * @type {Boolean}
         * @default false
         */
        selected: {
          type: Boolean,
          value: false,
          notify: true
        },

        /**
         * (Optional)
         *
         * An object with a function property called if the button is clicked or tapped.
         * The name of the property in the object is defined in toggleProperty.
         *
         * @type {Object}
         * @default {onToggle: function() {}}
         */
        toggleListener: {
          type: Object,
          value: function() {
            return {
              onToggle: function() {}
            };
          }
        },

        /**
         * (Optional)
         *
         * The name of the function property in toggleListener.
         *
         * @type {String}
         * @default 'onToggle'
         */
        toggleProperty: {
          type: String,
          value: 'onToggle'
        },

        /**
         * (Optional)
         *
         * URL to use for link.
         *
         * @type {String}
         */
        linkValue: {
          type: String,
          value: null
        },

        /**
         * The width of the horizontal bar as a percentage (count / max).  A minimum of 1 if count is positive.  100 if max is undefined or zero.
         *
         * @type {Number}
         * @private
         */
        _width: {
          type: Number,
          computed: '_computeWidth(count, max)'
        }
      },

      /**
       * Returns the width of the horizontal bar as a percentage using the given count and max.
       *
       * @param {Number} count
       * @param {Number} max
       * @return {Number}
       * @private
       */
      _computeWidth: function(count, max) {
        var width = max ? Math.round((count / max) * 100) : 100;
        return width === 0 && count ? 1 : width;
      },

      /**
       * Toggles the selected property and calls toggleListener[toggleProperty] whenever the checkbox is toggled.
       *
       * @event change
       * @private
       */
      _onToggle: function() {
        this.set('selected', !this.selected);
        this.toggleListener[this.toggleProperty]();
      }
    });
  })();
  </script>
</dom-module>
